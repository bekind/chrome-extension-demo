var w=window;CcjJSBridgeInstanceN={};CcjJSBridgeInstance={};var _vm_domain=getDomainUrl(location.host);var clientType=_vm_getCookie("client_type");var packageName=clientType=="ios"?_vm_getCookie("package_name"):_vm_getCookie("package");var clientVersion=clientType=="ios"?_vm_getCookie("client_version"):_vm_getCookie("version");var _vm_instance=clientType=="ios"?w.CcjJSBridgeInstance:w.CcjJSBridgeInstanceN;_vm_instance={shareToWeixin_type:function(data){toast("ios调用native shareToWeixin");console.info(data)},shareToWeixin:function(title,imgUrl,url,desc){toast("android调用native shareToWeixin");console.info("title:%s, imgUrl:%s, url:%s, desc:%s",title,imgUrl,url,desc)},sharetoweixinfriends:function(data){toast("调用native shareToWeixinFriends");console.log(data)},shareToWeixinFriends:function(title,imgUrl,url,desc,type){toast("调用native shareToWeixinFriends");console.info("title:%s, imgUrl:%s, url:%s, desc:%s, type: %s",title,imgUrl,url,desc,type)},setBounce:function(){},openQQ:function(){},openWeiXin:function(){},pay:function(data){toast("调用native pay")},savePictureToPhone:function(){},saveVideoToPhone:function(){},openPhotoAlbum:function(){},videoPlay:function(data){console.log(data)},backToHome:function(){},getContacts:function(){},refreshTab:function(){},popBack:function(){history.back()},showBigImages:function(){},oneKeyShare:function(data){toast("调用native oneKeyShare");console.log(data)},pasteboard:function(data){toast("调用native复制文案");console.log(data)},hideNavigation:function(data){var param=JSON.parse(data);var tip=param.type==1?"隐藏":"显示";console.info("不支持"+tip+"native导航条")},clearCache:function(){toast("调用native clearCache 清除缓存")},setShopCartCount:function(data){var param=JSON.parse(data);toast("更新native购物车数量为："+param.count)},callTemplate:function(data,queryPara){if(data){var template,query;if(clientType=="ios"){template=data.template;query=data.query?JSON.parse(data.query):{}}else if(clientType=="android"){template=data;query=typeof queryPara=="string"?JSON.parse(queryPara):queryPara}if(template=="WEB"){if(query.url){toast("调用native callTemplate WEB");setTimeout(function(){location.href=query.url},1500)}else{toast("调用callTemplate WEB时,参数有误，请检查")}}else if(template=="CHUCHUITEM"){var detailUrl="https://ccj.chuchutong.com/details/detail.html";if(location.href.indexOf("dev")!==-1||location.href.indexOf("master")!==-1){detailUrl="http://master.ccj.chuchutong.com/details/detail.html"}if(!query.productId){toast("调用callTemplate CHUCHUITEM时,参数错误，缺少商品id");return}else{detailUrl+="?id="+query.productId;if(query.adId){detailUrl+="&ad_id="+query.adId}if(query.couponId){detailUrl+="&couponId="+query.couponId}if(query.staticsId){detailUrl+="&staticsId="+query.staticsId}if(query.trackId){detailUrl+="&trackId"+query.trackId}toast("调用native callTemplate CHUCHUITEM");setTimeout(function(){location.href=detailUrl},1500)}}else if(template=="NATIVE_CUSTOMER"){toast("调用native客服")}else{toast("暂不支持该"+template+"方法，请native查看")}}},logout:function(data){var paramObj=JSON.parse(data);toast("调用native 退出登录");alert("token失效，重新登录")},getClientInfo:function(){toast("调用bridge getClientInfo");var clientInfoObj={channel:"QD_yyb",deviceBrand:"HONOR KNT-AL20",imei:"869395022509438",m_cck_access_token:_vm_getCookie("m_cck_access_token"),net:"wifi",packageName:packageName||"com.culiu.chuchutui",platform:clientType||"android",screen:"2408*1440",sdkVersion:"7.0",uid:"70085680",userId:"70085680",version:clientVersion||"",xingeToken:"Dag7MARMjqjhzMkrqEXoQkAwzG2ufIJM37pDl+3VdZE=",extension:"1"};var clientInfo={code:0,value:JSON.stringify(clientInfoObj)};var data=JSON.stringify(clientInfo);callback_getClientInfo(data)},getUserInfo:function(){toast("调用bridge getUserInfo");if(location.href.indexOf("daweixinke.com")!=-1)return;var cct_userInfo={id:"70085680",head_image_url:"https://wx.qlogo.cn/mmopen/aFK5bO4XliasvBFFic2wG4xOJo1kWxXboicLUricrricUEoL0Myj9j89bF28Ba4lBXQsNq5oph7OwrQEU9yOmouNIAJyVBQia99gYz/0",real_name:"NONE",occupation:0,u_type:0,phone_number:"",nick_name:"WX_10_P5QN2RZM",is_shangjia:"N",location:"北京",ctime:1487395365,birthday:"1969-03-15",id_number:"0",ascription:1,gender:"2"};var default_weChatUserInfo={openid:"ofOsk03UTpoOwULNEDVtv-wgfXwA",city:"Baoding",country:"CN",nickname:"杨敏",privilege:[],language:"zh_CN",headimgurl:"http://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJbja5Dibv4HSEjF9my0TbaS8rNvmexfjfXzTBUAd8TicicbPzzD6ckUY3eUv1ubYoWMMhibdMA7gaQg/0",unionid:"opTdBt7AnbuONhOTlTgD_IzbX1X8",sex:2,province:"Hebei"};if(!localStorage.getItem("extension-info")){var tk=_vm_getCookie("access_token");getUserInfoWithToken(tk,function(data){localStorage.setItem("extension-info",JSON.stringify(data));cct_userInfo=data;default_weChatUserInfo.nickname=data.nick_name;default_weChatUserInfo.headimgurl=data.head_image_url;default_weChatUserInfo.sex=data.gender}).done(function(){var userInfo={userInfo:cct_userInfo,weChatUserInfo:default_weChatUserInfo,code:0};callback_getUserInfo(JSON.stringify(userInfo))})}else{var data=JSON.parse(localStorage.getItem("extension-info"));cct_userInfo=data;default_weChatUserInfo.nickname=data.nick_name;default_weChatUserInfo.headimgurl=data.head_image_url;default_weChatUserInfo.sex=data.gender;var userInfo={userInfo:cct_userInfo,weChatUserInfo:default_weChatUserInfo,code:0};callback_getUserInfo(JSON.stringify(userInfo))}}};function initIOSEnv(){w.webkit={messageHandlers:{}};for(var _key in _vm_instance){w.webkit.messageHandlers[_key]={};w.webkit.messageHandlers[_key].postMessage=function(_key){return function(data){_vm_instance[_key](data)}}(_key)}}if(clientType=="ios"){initIOSEnv()}else{CcjJSBridgeInstanceN=_vm_instance}function _vm_setCookie(name,value,days){var d=new Date;d.setTime(d.getTime()+days*24*3600*1e3);var expires="expires="+d.toUTCString();document.cookie=name+"="+value+";path=/;domain="+_vm_domain+";"+expires}function _vm_getCookie(name){var reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)"),r=document.cookie.match(reg);return r?decodeURIComponent(r[2]):null}function getDomainUrl(url){var tokenDomain="";if(url.indexOf("chuchutong.com")!=-1){tokenDomain=".chuchutong.com"}else if(url.indexOf(".daweixinke.com")!=-1){tokenDomain=".daweixinke.com"}else if(url.indexOf(".chuchujie.com")!=-1){tokenDomain=".chuchujie.com"}else{var splits=url.split(".");var len=splits.length;if(len>1){tokenDomain="."+splits[len-2]+".com"}}return tokenDomain}function toast(str){var bottom=5;var alreadyHas=$(".toastClass1").length;if(alreadyHas){bottom=5*($(".toast-tip").length+1)*1.2;var tipDom='<p class="toast-tip" style="position: absolute;bottom: '+bottom+'%;right: 0;width: 90%;-webkit-transform:translateY(-50%); transform:translateY(-50%);text-align: right;">'+'<span style="display:inline-block; line-height:36px;color: #FFF;border-radius: 3px;padding:0.2rem;background: rgba(0, 0, 0, .8);">'+str+"</span>"+"</p>";$(".toastClass1").append(tipDom);return}var t="alerty"+parseInt(Math.random()*100),tem='<div class="toastClass1" id="'+t+'" style="font-size:12px;position: fixed;top: 0;left: 0; width: 100%;height: 100%;z-index: 1001;">'+'<p class="toast-tip" style="position: absolute;bottom: '+bottom+'%;right: 0;width: 90%;-webkit-transform:translateY(-50%); transform:translateY(-50%);text-align: right;">'+'<span style="display:inline-block;line-height:36px; color: #FFF;border-radius: 3px;padding:0.2rem;background: rgba(0, 0, 0, .8);">'+str+"</span>"+"</p>"+"</div>";$("body").append($(tem));var $alert=$("#"+t+""),timeer=null;timeer=setTimeout(function(){$alert.remove();clearTimeout(timeer)},2e3)}function getUserInfoWithToken(token,success,fail){var def=$.Deferred();var url="https://api-passport.chuchujie.com/api.php";var sendData={channel:"QD_yyb",package_name:"com.culiu.chuchutui",client_version:"1.0",ageGroup:"AG_0to24",client_type:"ios",api_version:"v5",imei:"869395022509438",method:"get_user_info",gender:"1",token:token,userId:"",browser_type:"other",front_version:"201802021512",subChannel:"ccjtg",business_type:"cctui"};if(isTest){url="http://dev-dwxk-np.chuchujie.com/api.php"}$.ajax({url:url,type:"POST",data:{data:JSON.stringify(sendData)}}).done(function(response){response=typeof response=="string"?JSON.parse(response):response;if(response.status==0){if(success&&typeof success=="function"){success(response.data)}}else{if(fail&&typeof fail=="function"){fail(response)}console.error("获取用户信息失败")}def.resolve()}).fail(function(){def.resolve();console.error("获取用户信息失败")});return def}function isTest(){return location.href.indexOf("dev")!=-1||location.href.indexOf("master")!=-1}